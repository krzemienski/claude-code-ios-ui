name: ClaudeCodeUI
options:
  bundleIdPrefix: com.claudecode
  deploymentTarget:
    iOS: 17.0
  createIntermediateGroups: true
  generateEmptyDirectories: true
  developmentLanguage: en

packages:
  Starscream:
    url: https://github.com/daltoniam/Starscream.git
    from: 4.0.6
  
settings:
  base:
    PRODUCT_NAME: ClaudeCodeUI
    MARKETING_VERSION: 1.0.0
    CURRENT_PROJECT_VERSION: 1
    SWIFT_VERSION: 5.9
    IPHONEOS_DEPLOYMENT_TARGET: 17.0
    ENABLE_PREVIEWS: YES
    DEVELOPMENT_TEAM: ""
    CODE_SIGN_STYLE: Automatic
    INFOPLIST_FILE: App/Info.plist
    
targets:
  ClaudeCodeUI:
    type: application
    platform: iOS
    deploymentTarget: 17.0
    dependencies:
      - package: Starscream
        product: Starscream
    sources:
      - path: App
        excludes:
          - "**/.DS_Store"
      - path: Core
        excludes:
          - "**/.DS_Store"
      - path: Features
        excludes:
          - "**/.DS_Store"
      - path: Design
        excludes:
          - "**/.DS_Store"
      - path: Models
        excludes:
          - "**/.DS_Store"
      - path: UI
        excludes:
          - "**/.DS_Store"
          - "README.md"
      - path: Resources
        excludes:
          - "**/.DS_Store"
          - "Info.plist"
        buildPhase: resources
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.claudecode.ui
        INFOPLIST_KEY_UIApplicationSceneManifest_Generation: YES
        INFOPLIST_KEY_UIApplicationSupportsIndirectInputEvents: YES
        INFOPLIST_KEY_UILaunchScreen_Generation: YES
        INFOPLIST_KEY_UISupportedInterfaceOrientations: "UIInterfaceOrientationPortrait UIInterfaceOrientationPortraitUpsideDown UIInterfaceOrientationLandscapeLeft UIInterfaceOrientationLandscapeRight"
        INFOPLIST_KEY_UISupportedInterfaceOrientations~ipad: "UIInterfaceOrientationPortrait UIInterfaceOrientationPortraitUpsideDown UIInterfaceOrientationLandscapeLeft UIInterfaceOrientationLandscapeRight"
        INFOPLIST_KEY_UILaunchStoryboardName: LaunchScreen
        INFOPLIST_KEY_UIRequiredDeviceCapabilities: 
          - arm64
        INFOPLIST_KEY_CFBundleDisplayName: Claude Code
        INFOPLIST_KEY_LSApplicationCategoryType: public.app-category.developer-tools
        INFOPLIST_KEY_NSCameraUsageDescription: "This app needs camera access to capture images for code analysis"
        INFOPLIST_KEY_NSPhotoLibraryUsageDescription: "This app needs photo library access to select images"
        INFOPLIST_KEY_NSMicrophoneUsageDescription: "This app needs microphone access for voice commands"
        INFOPLIST_KEY_UIStatusBarStyle: UIStatusBarStyleLightContent
        INFOPLIST_KEY_UIUserInterfaceStyle: Dark
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS: YES
        DEVELOPMENT_ASSET_PATHS: ""
        ENABLE_HARDENED_RUNTIME: NO
        LD_RUNPATH_SEARCH_PATHS:
          - $(inherited)
          - "@executable_path/Frameworks"
        SWIFT_EMIT_LOC_STRINGS: YES
        TARGETED_DEVICE_FAMILY: "1,2"
    preBuildScripts:
      - script: |
          echo "Building ClaudeCodeUI for iOS"
          echo "Target: iOS 17.0+"
          echo "Backend: ws://192.168.0.43:3004"
        name: "Pre-Build Info"
    postBuildScripts:
      - script: |
          echo "Build completed for ClaudeCodeUI"
          echo "App Bundle ID: com.claudecode.ui"
        name: "Post-Build Info"
    info:
      path: App/Info.plist
      properties:
        CFBundleDisplayName: Claude Code
        CFBundleShortVersionString: 1.0.0
        CFBundleVersion: 1
        UILaunchScreen:
          UIColorName: BackgroundColor
        UISupportedInterfaceOrientations:
          - UIInterfaceOrientationPortrait
          - UIInterfaceOrientationLandscapeLeft
          - UIInterfaceOrientationLandscapeRight
        UISupportedInterfaceOrientations~ipad:
          - UIInterfaceOrientationPortrait
          - UIInterfaceOrientationPortraitUpsideDown
          - UIInterfaceOrientationLandscapeLeft
          - UIInterfaceOrientationLandscapeRight
        UIApplicationSceneManifest:
          UIApplicationSupportsMultipleScenes: false
          UISceneConfigurations:
            UIWindowSceneSessionRoleApplication:
              - UISceneConfigurationName: Default Configuration
                UISceneDelegateClassName: "$(PRODUCT_MODULE_NAME).SceneDelegate"
        NSAppTransportSecurity:
          NSAllowsArbitraryLoads: true
          NSExceptionDomains:
            192.168.0.43:
              NSExceptionAllowsInsecureHTTPLoads: true
              NSIncludesSubdomains: true
            localhost:
              NSExceptionAllowsInsecureHTTPLoads: true
              NSIncludesSubdomains: true

  ClaudeCodeUITests:
    type: bundle.unit-test
    platform: iOS
    deploymentTarget: 17.0
    sources:
      - path: Tests
    dependencies:
      - target: ClaudeCodeUI
    settings:
      PRODUCT_NAME: ClaudeCodeUITests
      PRODUCT_BUNDLE_IDENTIFIER: com.claudecode.ui.tests
      TEST_HOST: "$(BUILT_PRODUCTS_DIR)/ClaudeCodeUI.app/$(BUNDLE_EXECUTABLE_FOLDER_PATH)/ClaudeCodeUI"
      BUNDLE_LOADER: "$(TEST_HOST)"

  ClaudeCodeUIUITests:
    type: bundle.ui-testing
    platform: iOS
    deploymentTarget: 17.0
    sources:
      - path: ClaudeCodeUIUITests
    dependencies:
      - target: ClaudeCodeUI
    settings:
      PRODUCT_NAME: ClaudeCodeUIUITests
      PRODUCT_BUNDLE_IDENTIFIER: com.claudecode.ui.uitests
      TEST_TARGET_NAME: ClaudeCodeUI

  ClaudeCodeUIIntegrationTests:
    type: bundle.unit-test
    platform: iOS
    deploymentTarget: 17.0
    sources:
      - path: ClaudeCodeUIIntegrationTests
    dependencies:
      - target: ClaudeCodeUI
    settings:
      PRODUCT_NAME: ClaudeCodeUIIntegrationTests
      PRODUCT_BUNDLE_IDENTIFIER: com.claudecode.ui.integrationtests
      TEST_HOST: "$(BUILT_PRODUCTS_DIR)/ClaudeCodeUI.app/$(BUNDLE_EXECUTABLE_FOLDER_PATH)/ClaudeCodeUI"
      BUNDLE_LOADER: "$(TEST_HOST)"

schemes:
  ClaudeCodeUI:
    build:
      targets:
        ClaudeCodeUI: all
    run:
      config: Debug
      environmentVariables:
        BACKEND_URL: "ws://192.168.0.43:3004"
        NO_MOCKS: "true"
    test:
      config: Debug
      targets:
        - ClaudeCodeUITests
        - ClaudeCodeUIUITests
        - ClaudeCodeUIIntegrationTests
    archive:
      config: Release